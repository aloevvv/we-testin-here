<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Five Nights At Starr Park</title>
  <style>
    body {
      margin: 0;
      background-color: black;
      font-family: 'Courier New', monospace;
      color: white;
      text-align: center;
    }

    #menu {
      margin-top: 20%;
    }

    .menu-option {
      font-size: 24px;
      margin: 15px;
      cursor: pointer;
    }

    .disabled {
      color: gray;
      cursor: not-allowed;
    }

    #game {
      display: none;
      position: relative;
      width: 100vw;
      height: 100vh;
      overflow: hidden;
    }

    #office, #camView {
      width: 100%;
      height: 100%;
      object-fit: cover;
      position: absolute;
      top: 0;
      left: 0;
    }

    #cameraBtn {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      width: 150px;
      cursor: pointer;
      z-index: 12;
      top: unset; 
    }
    #camLabel {
  position: absolute;
  top: 10px;
  left: 10px;
  font-size: 28px;
  font-family: 'Courier New', monospace;
  color: white;
  background-color: rgba(0,0,0,0.5);
  padding: 5px 10px;
  border-radius: 4px;
  z-index: 15;
}


    #map {
      position: absolute;
      bottom: 20px;
      right: 20px;
      width: 320px;
      height: 240px;
      display: none;
      z-index: 6;
    }

    #staticOverlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      opacity: 0.3;
      display: none;
      z-index: 10;
      pointer-events: none;
    }
    .door {
  position: absolute;
  top: 0;
  height: 100%;
  width: 100%;
  z-index: 8;
}

.door-left {
  left: 0;
}

.door-right {
  right: 0;
}

#darkOverlay {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: black;
  opacity: 0; 
  pointer-events: none;
  z-index: 20;
  transition: opacity 0.5s;
}

  </style>
</head>
<body>
  <!-- Menu -->
  <div id="menu">
    <h1>Five Nights At Starr Park</h1>
    <div id="newGameBtn" class="menu-option">New Game</div>
    <div id="continueBtn" class="menu-option disabled">Continue</div>
    <div id="customNightBtn" class="menu-option" style="display:none;">Custom Night</div>
  </div>

  <!-- Game Scene -->
  <div id="game">
    <img id="office" src="office.png" alt="Office">
    <img id="camView" src="CAM1PMS.png" style="display:none;">
    <img id="cameraBtn" src="camera.png">
    <img id="map" src="map.png">
    <div id="camLabel">CAM1</div>
    <img id="staticOverlay" src="static.gif">
    <img id="doorA" src="doorAoff.png" class="door door-left">
    <img id="doorB" src="doorBoff.png" class="door door-right">
    <img id="rocket" src="rocket.png" style="display:none; position:absolute; z-index:21;">
    <div id="darkOverlay"></div>
    <div id="powerLabel" style="
  position:absolute; bottom:10px; left:10px;
  font-size:24px; color:white; font-family:'Courier New', monospace;
  z-index:15;">120%</div>
    <div id="hourLabel" style="
  position:absolute; top:10px; right:10px;
  font-size:28px; color:white; font-family:'Courier New', monospace;
  z-index:15;">12AM</div>
    <img id="sixAmScreen" src="6am.png" 
     style="display:none; position:absolute; top:0; left:0; width:100%; height:100%; z-index:30;">
  </div>

  <div id="customNightMenu" style="display:none; margin-top:20px;">
  <label>Punch AI: <input type="number" id="customPunch" min="0" max="20" value="1"></label><br>
  <label>Snipe AI: <input type="number" id="customSnipe" min="0" max="20" value="9"></label><br>
  <label>Mouse AI: <input type="number" id="customMouse" min="0" max="20" value="8"></label><br>
  <label>Boss AI: <input type="number" id="customBoss" min="0" max="20" value="7"></label><br>
  <button id="startCustomNight">Start Custom Night</button>
</div>



  <!-- Ambience Audio -->
  <audio id="ambience" src="ambience.mp3" loop></audio>
  <audio id="footsteps" src="footsteps.mp3"></audio>

  <script>
// ====== GAME STATE ======
let CamOn = false;
let currentCam = "CAM1";
let paranoiaTimer = null;
let paranoid = false;
let Night6 = false;

let Night1Won = localStorage.getItem("Night1Won") === "true";
let Night2Won = localStorage.getItem("Night2Won") === "true";
let Night3Won = localStorage.getItem("Night3Won") === "true";
let Night4Won = localStorage.getItem("Night4Won") === "true";
let Night5Won = localStorage.getItem("Night5Won") === "true";

let currentNight = parseInt(localStorage.getItem("currentNight")) || 1;
let currentHour = 12;
let nightTimer = null;



// Enemy positions
let Punch = "CAM1";
let Snipe = "CAM1";
let Mouse = "CAM1";

let BossStage = 1;       
let BossProgress = 0; 
let bossTimer = null;
let rocketActive = false;
let rocketCam = null;
let rocketTimer = null;
let bossMaddenedTimer = null;

// AI levels
let PunchAI = 0;
let SnipeAI = 0;
let MouseAI = 0;
let BossAI = 0;

const nightAI = {
  1: {
    12: { Punch: 0, Snipe: 0, Mouse: 0, Boss: 0 },
    1:  { Punch: 0, Snipe: 0, Mouse: 0, Boss: 0 },
    2:  { Punch: 2, Snipe: 2, Mouse: 2, Boss: 0 },
    3:  { Punch: 3, Snipe: 3, Mouse: 4, Boss: 0 },
    4:  { Punch: 3, Snipe: 3, Mouse: 4, Boss: 0 },
    5:  { Punch: 3, Snipe: 3, Mouse: 5, Boss: 0 }
  },
  2: {
    12: { Punch: 5, Snipe: 5, Mouse: 6, Boss: 6 },
    1:  { Punch: 5, Snipe: 6, Mouse: 6, Boss: 6 },
    2:  { Punch: 5, Snipe: 6, Mouse: 6, Boss: 6 },
    3:  { Punch: 5, Snipe: 6, Mouse: 6, Boss: 6 },
    4:  { Punch: 7, Snipe: 6, Mouse: 6, Boss: 6 },
    5:  { Punch: 7, Snipe: 6, Mouse: 6, Boss: 6 }
  },
  3: {
   12: { Punch: 8, Snipe: 7, Mouse: 8, Boss: 10 },
    1:  { Punch: 9, Snipe: 8, Mouse: 8, Boss: 10 },
    2:  { Punch: 9, Snipe: 9, Mouse: 8, Boss: 10 },
    3:  { Punch: 10, Snipe: 9, Mouse: 8, Boss: 10 },
    4:  { Punch: 10, Snipe: 9, Mouse: 8, Boss: 10 },
    5:  { Punch: 10, Snipe: 9, Mouse: 8, Boss: 10 }
  },
  4: {
    12: { Punch: 12, Snipe: 11, Mouse: 10, Boss: 13 },
    1:  { Punch: 12, Snipe: 12, Mouse: 10, Boss: 13 },
    2:  { Punch: 12, Snipe: 12, Mouse: 10, Boss: 13 },
    3:  { Punch: 12, Snipe: 13, Mouse: 12, Boss: 13 },
    4:  { Punch: 12, Snipe: 13, Mouse: 13, Boss: 13 },
    5:  { Punch: 12, Snipe: 13, Mouse: 14, Boss: 13 }
  },
  5: {
    12: { Punch: 14, Snipe: 14, Mouse: 15, Boss: 16 },
    1:  { Punch: 14, Snipe: 14, Mouse: 15, Boss: 16 },
    2:  { Punch: 15, Snipe: 14, Mouse: 15, Boss: 16 },
    3:  { Punch: 16, Snipe: 17, Mouse: 15, Boss: 16 },
    4:  { Punch: 16, Snipe: 17, Mouse: 15, Boss: 16 },
    5:  { Punch: 16, Snipe: 17, Mouse: 15, Boss: 16 }
  }
};

    
let doorAParanoiaTimer = null;
let doorBParanoiaTimer = null;

// Track cumulative closed time
let doorATotalClosed = 0;
let doorBTotalClosed = 0;
let doorPower = 120;

// Track when door was last closed
let doorAClosedAt = null;
let doorBClosedAt = null;

let doorADisabled = false;
let doorBDisabled = false;


// Valid paths
const PunchPath = ["CAM1","CAM5","CAM4","CAM9A"];
const SnipePath = ["CAM1","CAM2","CAM3","CAM8","CAM6","CAM9B"];
const MousePath = ["CAM1","CAM1B","CAM2","CAM3","CAM8","CAM6","CAM9B"];

// Door states
let doorAClosed = false;
let doorBClosed = false;

// Infection meter
let infected = 0; // 0â€“60
let infectionInterval = null;

// Kill timers
let punchDoorTimer = null;
let snipeDoorTimer = null;
let mouseDoorTimer = null;

// ====== GAME START ======
function startNewGame() {
  document.getElementById("menu").style.display = "none";
  document.getElementById("game").style.display = "block";
  Night6 = false;
  const ambience = document.getElementById("ambience");
  ambience.volume = 0.1;
  ambience.play();
  startAI();
  startInfectionMeter();
  startNight();
  bossTimer = setInterval(updateBoss, 5000);
}
    function advanceHour() {
  if (currentHour === 12) {
    currentHour = 1;
  } else {
    currentHour++;
  }

  setAIForHour(currentNight, currentHour);

  updateHourLabel();

  if (currentHour === 6) {
    endNight();
  }
}

function setAIForHour(night, hour) {
  if (Night6) {
    console.log(`Custom Night: Punch=${PunchAI}, Snipe=${SnipeAI}, Mouse=${MouseAI}, Boss=${BossAI}`);
  } else if (nightAI[night] && nightAI[night][hour]) {
    PunchAI = nightAI[night][hour].Punch;
    SnipeAI = nightAI[night][hour].Snipe;
    MouseAI = nightAI[night][hour].Mouse;
    BossAI = nightAI[night][hour].Boss;
    console.log(`Night ${night}, ${hour}AM: Punch=${PunchAI}, Snipe=${SnipeAI}, Mouse=${MouseAI}, Boss=${BossAI}`);
  }
}


    
    document.getElementById("customNightBtn").addEventListener("click", () => {
  document.getElementById("menu").style.display = "none";
  document.getElementById("customNightMenu").style.display = "block";
});

document.getElementById("startCustomNight").addEventListener("click", () => {
  resetAllGameStates();
  PunchAI = parseInt(document.getElementById("customPunch").value);
  SnipeAI = parseInt(document.getElementById("customSnipe").value);
  MouseAI = parseInt(document.getElementById("customMouse").value);
  BossAI = parseInt(document.getElementById("customBoss").value);

  Night6 = true;
  setAIForHour(currentNight, currentHour);

  
  document.getElementById("customNightMenu").style.display = "none";
  document.getElementById("game").style.display = "block";
  startAI();
  startInfectionMeter();
  startNight();
  bossTimer = setInterval(updateBoss, 5000);
});



    function startNight() {
  currentHour = 12;
  updateHourLabel();
  doorPower = 120;
  updatePowerLabel();
  
  nightTimer = setInterval(() => {
    advanceHour();
  }, 60000); 
}
    function endNight() {
  clearInterval(nightTimer);
  nightTimer = null;

  CamOn = false;
  document.getElementById("office").style.display = "block";
  document.getElementById("camView").style.display = "none";
  document.getElementById("map").style.display = "none";
  document.getElementById("staticOverlay").style.display = "none";
  document.getElementById("doorA").style.display = "block";
  document.getElementById("doorB").style.display = "block";

  const sixAmScreen = document.getElementById("sixAmScreen");
  sixAmScreen.style.display = "block";


  setTimeout(() => {
    sixAmScreen.style.display = "none"; 
    resetAllGameStates();

    if (currentNight === 1) {
      Night1Won = true;
      localStorage.setItem("Night1Won", "true");
      currentNight = 2;
    } else if (currentNight === 2) {
      Night2Won = true;
      localStorage.setItem("Night2Won", "true");
      currentNight = 3;
    } else if (currentNight === 3) {
      Night3Won = true;
      localStorage.setItem("Night3Won", "true");
      currentNight = 4;
    } else if (currentNight === 4) {
      Night4Won = true;
      localStorage.setItem("Night4Won", "true");
      currentNight = 5;
    } else if (currentNight === 5) {
      Night5Won = true;
      localStorage.setItem("Night5Won", "true");
      showMenu();
      return;
    }

    localStorage.setItem("currentNight", currentNight);
    startNight();
  }, 3000); 
}



function updateHourLabel() {
  let label;
  if (currentHour === 12) {
    label = "12AM";
  } else {
    label = currentHour + "AM";
  }
  document.getElementById("hourLabel").textContent = label;
}




// ====== CAMERA TOGGLE ======
function toggleCamera() {
  CamOn = !CamOn;
  if (CamOn) {
    document.getElementById("office").style.display = "none";
    document.getElementById("camView").style.display = "block";
    document.getElementById("map").style.display = "block";
    document.getElementById("staticOverlay").style.display = "block";
    document.getElementById("doorA").style.display = "none";
    document.getElementById("doorB").style.display = "none";
    resetParanoia();
    updateCameraView();
  } else {
    document.getElementById("office").style.display = "block";
    document.getElementById("camView").style.display = "none";
    document.getElementById("map").style.display = "none";
    document.getElementById("staticOverlay").style.display = "none";
    document.getElementById("doorA").style.display = "block";
    document.getElementById("doorB").style.display = "block";
    clearTimeout(paranoiaTimer);
  }
}

window.addEventListener("DOMContentLoaded", () => {
  
  document.getElementById("cameraBtn").addEventListener("click", toggleCamera);

  document.getElementById("newGameBtn").addEventListener("click", startNewGame);

document.addEventListener("keydown", e => {
  
  if (e.code === "Space") {
    toggleCamera();
    return; 
  }

  if (!CamOn) return;
  switch(e.key) {
    case "1": currentCam="CAM1"; break;
    case "2": currentCam="CAM2"; break;
    case "3": currentCam="CAM3"; break;
    case "4": currentCam="CAM4"; break;
    case "5": currentCam="CAM5"; break;
    case "6": currentCam="CAM6"; break;
    case "7": currentCam="CAM7"; break;
    case "8": currentCam="CAM8"; break;
    case "9": currentCam="CAM9A"; break;
    case "0": currentCam="CAM9B"; break;
  }
  updateCameraView();
  resetParanoia();
});

  function resetParanoia() {
  if (paranoiaTimer) {
    clearTimeout(paranoiaTimer);
    paranoiaTimer = null;
  }

  paranoiaTimer = setTimeout(() => {
    paranoid = true;
    console.log("Paranoia triggered!");
  }, 15000); 
}



  document.addEventListener("keydown", e => {
  if (e.key === "a" || e.key === "A") {
    if (doorADisabled) return;

    doorAClosed = !doorAClosed;
    document.getElementById("doorA").src = doorAClosed ? "doorAon.png" : "doorAoff.png";

    let audioA = new Audio("door.mp3");
    audioA.play();

    if (doorAClosed) {
      resetDoor("A");
      startParanoiaTimer("A");
      doorAClosedAt = Date.now();
    } else {
      clearParanoiaTimer("A");
      if (doorAClosedAt) {
        doorATotalClosed += (Date.now() - doorAClosedAt) / 1000;
        doorAClosedAt = null;
      }
      checkDisable("A");
    }
  }
    
if (e.key === "e" || e.key === "E") {
  if (BossStage === "Maddened") {
 
    if (bossMaddenedTimer) {
      clearTimeout(bossMaddenedTimer);
      bossMaddenedTimer = null;
    }
    BossStage = 4;
    BossProgress = 0; 
    console.log("Boss calmed back to Stage 4 instantly");
    updateBossCam();
  } else if (BossStage === 4) {
    BossStage = 5;
    spawnRocket();
    console.log("Boss forced to Stage 5!");
  }
}



  if (e.key === "d" || e.key === "D") {
    if (doorBDisabled) return;

    doorBClosed = !doorBClosed;
    document.getElementById("doorB").src = doorBClosed ? "doorBon.png" : "doorBoff.png";

    let audioB = new Audio("door.mp3");
    audioB.play();

    if (doorBClosed) {
      resetDoor("B");
      startParanoiaTimer("B");
      doorBClosedAt = Date.now();
    } else {
      clearParanoiaTimer("B");
      if (doorBClosedAt) {
        doorBTotalClosed += (Date.now() - doorBClosedAt) / 1000;
        doorBClosedAt = null;
      }
      checkDisable("B");
      }
    }
  });
});


// ====== CAMERA IMAGE ======
function getActualImage(cam) {
  let enemiesHere = [];
  if (Punch === cam) enemiesHere.push("P");
  if (Snipe === cam) enemiesHere.push("S");
  if (Mouse === cam) enemiesHere.push("M");

  if (cam === "CAM7") {
    return getBossImage();
  }

  return enemiesHere.length > 0 ? cam + enemiesHere.join("") + ".png" : cam + ".png";
}
    function getBossImage() {
  if (BossStage === 1) return "CAM7stage1.png";
  if (BossStage === 2) return "CAM7stage2.png";
  if (BossStage === 3) return "CAM7stage3.png";
  if (BossStage === 4) return "CAM7stage4.png";
  if (BossStage === "Maddened") return "CAM7stageangry.png";
  if (BossStage === 5) return "CAM7stage5.png";
  return "CAM7stage1.png";
}


function getHallucinationImages(cam) {
  let options = [cam + ".png"];
  if (MousePath.includes(cam)) options.push(cam + "M.png");
  if (SnipePath.includes(cam)) options.push(cam + "S.png");
  if (PunchPath.includes(cam)) options.push(cam + "P.png");
  if (MousePath.includes(cam) && SnipePath.includes(cam)) options.push(cam + "MS.png");
  if (PunchPath.includes(cam) && SnipePath.includes(cam)) options.push(cam + "PS.png");
  if (PunchPath.includes(cam) && MousePath.includes(cam)) options.push(cam + "PM.png");
  if (PunchPath.includes(cam) && MousePath.includes(cam) && SnipePath.includes(cam)) options.push(cam + "PMS.png");

  if (cam === "CAM7") {
    options = [
      "CAM7stage4.png",
      "CAM7stageangry.png",
      "CAM7stage5.png"
    ];
  }
  return options;
}

function updateCameraView() {
  const camView = document.getElementById("camView");
  if (paranoid && Math.random() < 0.5) {
    let hallucinations = getHallucinationImages(currentCam);
    camView.src = hallucinations[Math.floor(Math.random() * hallucinations.length)];
  } else {
    camView.src = getActualImage(currentCam);
  }

  document.getElementById("camLabel").textContent = currentCam;
  updateRocketView();
}


// ====== AI LOOP ======
function startAI() {
  setInterval(movePunch, 5000);
  setInterval(moveSnipe, 5000);
  setInterval(moveMouse, 2500);
}

function playFootsteps() {
  document.getElementById("footsteps").play();
}

// Punch AI
function movePunch() {
  let roll = Math.floor(Math.random() * 20) + 1;
  if (roll <= PunchAI) {
    if (Punch==="CAM1") { Punch="CAM5"; }
    else if (Punch==="CAM5") { Punch=Math.random()<0.5?"CAM4":"CAM9A"; }
    else if (Punch==="CAM4") { Punch="CAM5"; }
    else if (Punch==="CAM9A") { Punch=Math.random()<0.75?"doorA":"CAM5"; }
    playFootsteps();
    updateCameraView();
    checkDoorStates();
    updateDoorSprites();
  }
}

// Snipe AI
function moveSnipe() {
  let roll = Math.floor(Math.random() * 20) + 1;
  if (roll <= SnipeAI) {
    if (Snipe==="CAM1") Snipe="CAM2";
    else if (Snipe==="CAM2") Snipe="CAM3";
    else if (Snipe==="CAM3") Snipe=Math.random()<0.75?"CAM8":"CAM2";
    else if (Snipe==="CAM8") Snipe="CAM6";
    else if (Snipe==="CAM6") Snipe=Math.random()<0.75?"CAM9B":"CAM8";
    else if (Snipe==="CAM9B") Snipe="doorB";
    playFootsteps();
    updateCameraView();
    checkDoorStates();
    updateDoorSprites();
  }
}

// Mouse AI
let mouseFootstepTimer = null;

function moveMouse() {
  let roll = Math.floor(Math.random() * 20) + 1;
  if (roll <= MouseAI) {
    if (Mouse==="CAM1") {
      Mouse = Math.random()<0.8 ? "CAM1B" : "CAM2";
    } else if (Mouse==="CAM1B") {
      Mouse = Math.random()<0.9 ? "CAM1B" : "CAM1";
      if (!mouseFootstepTimer) {
        mouseFootstepTimer = setInterval(() => {
          playFootsteps();
        }, 5000);
        if (CamOn) {
    clearTimeout(paranoiaTimer);
    paranoiaTimer = setTimeout(() => {
      paranoid = true;
      console.log("Paranoia triggered early by Mouse at CAM1B");
    }, 7000);
  }
      }
    } else {
      if (mouseFootstepTimer) {
        clearInterval(mouseFootstepTimer);
        mouseFootstepTimer = null;
      }
      if (Mouse==="CAM2") Mouse="CAM3";
      else if (Mouse==="CAM3") Mouse="CAM8";
      else if (Mouse==="CAM8") Mouse="CAM6";
      else if (Mouse==="CAM6") Mouse="CAM9B";
      else if (Mouse==="CAM9B") Mouse="doorB";
    }

    updateCameraView();
    checkDoorStates();
    updateDoorSprites();
  }
}

    function updateBoss() {
  if (BossStage <= 3) {
    if (CamOn && currentCam === "CAM7") {
      console.log("Boss progress blocked by CAM7 view");
    } else {
      BossProgress += BossAI;
      if ((BossStage === 1 && BossProgress >= 60) ||
          (BossStage === 2 && BossProgress >= 60) ||
          (BossStage === 3 && BossProgress >= 100)) {
        BossStage++;
        BossProgress = 0;
      }
    }
  } else if (BossStage === 4) {
    let roll = Math.floor(Math.random() * 20) + 1;
    if (roll <= BossAI) {
      BossStage = "Maddened";
      console.log("Boss entered Maddened Stage!");
    }
  } else if (BossStage === "Maddened") {
   
    bossMaddenedTimer = setTimeout(() => {
      BossStage = 5;
      spawnRocket();
    }, 5000);
  }

  updateBossCam();
}


function updateBossCam() {
  const camView = document.getElementById("camView");
  if (currentCam === "CAM7") {
    if (BossStage === 1) camView.src = "CAM7stage1.png";
    else if (BossStage === 2) camView.src = "CAM7stage2.png";
    else if (BossStage === 3) camView.src = "CAM7stage3.png";
    else if (BossStage === 4) camView.src = "CAM7stage4.png";
    else if (BossStage === "Maddened") camView.src = "CAM7stageangry.png";
    else if (BossStage === 5) camView.src = "CAM7stage5.png";
  }
}
function spawnRocket() {
  let cams = ["CAM2","CAM3","CAM4","CAM5","CAM6","CAM8"];
  rocketCam = cams[Math.floor(Math.random() * cams.length)];
  rocketActive = true;

  const rocket = document.getElementById("rocket");
  rocket.style.display = "block";
  rocket.style.top = "40%";  
  rocket.style.left = "50%"; 
  rocket.src = "rocket.png";
  rocket.style.zIndex = 21;
  updateRocketView();

  console.log("Rocket spawned in", rocketCam);

  infectionInterval = setInterval(() => {
    infected = Math.min(60, infected+1);
    darkenScreen();
  }, 1000);

  rocketTimer = setTimeout(() => {
    if (rocketActive) killPlayer("Boss");
  }, 8000);
}

    function updateRocketView() {
  const rocket = document.getElementById("rocket");
  if (rocketActive && CamOn && currentCam === rocketCam) {
    rocket.style.display = "block";
  } else {
    rocket.style.display = "none";
  }
}



function clickRocket(cam) {
  if (rocketActive && cam === rocketCam) {
    rocketActive = false;
    clearInterval(infectionInterval);
    clearTimeout(rocketTimer);
    BossStage = 2;
    BossProgress = 0;
    console.log("Rocket defused, Boss reset to Stage 2");
    updateRocketView();
  }
}

document.getElementById("rocket").addEventListener("click", () => {
  if (rocketActive && currentCam === rocketCam) {
    rocketActive = false;
    document.getElementById("rocket").style.display = "none";
    clearInterval(infectionInterval);
    clearTimeout(rocketTimer);
    BossStage = 2;
    BossProgress = 0;
    console.log("Rocket defused, Boss reset to Stage 2");
  }
});


function updateDoorSprites() {
  
  if (Punch === "doorA" && !doorAClosed) {
    document.getElementById("doorA").src = "doorApunch.png";
  } else {
    document.getElementById("doorA").src = doorAClosed ? "doorAon.png" : "doorAoff.png";
  }

  
  if (Snipe === "doorB" && !doorBClosed) {
    document.getElementById("doorB").src = "doorBsnipe.png";
  } else {
    document.getElementById("doorB").src = doorBClosed ? "doorBon.png" : "doorBoff.png";
  }
}

function startInfectionMeter() {
  infectionInterval = setInterval(() => {
    if ((Punch==="doorA" && !doorAClosed) || (Snipe==="doorB" && !doorBClosed) || (Mouse==="doorB" && !doorBClosed)) {
      infected = Math.min(60, infected+1);
      darkenScreen();
    }
  }, 2000);
}

function darkenScreen() {
  let overlay = document.getElementById("darkOverlay");
  overlay.style.opacity = infected/60; 
}

function checkDoorStates() {
  if (Punch==="doorA" && !doorAClosed) {
    if (!punchDoorTimer) punchDoorTimer = setTimeout(()=>killPlayer("Punch"),10000);
  }
  if (Snipe==="doorB" && !doorBClosed) {
    if (!snipeDoorTimer) snipeDoorTimer = setTimeout(()=>killPlayer("Snipe"),10000);
  }
  if (Mouse==="doorB" && !doorBClosed) {
    if (!mouseDoorTimer) mouseDoorTimer = setTimeout(()=>killPlayer("Mouse"),10000);
  }
}

function resetDoor(which) {
  if (which==="A") {
    if (Punch==="doorA") {
      Punch="CAM1";
      clearTimeout(punchDoorTimer);
      punchDoorTimer = null;
      let bangA = new Audio("metalbang.mp3");
      bangA.play();
    }
  }
  if (which==="B") {
    if (Snipe==="doorB") {
      Snipe="CAM1";
      clearTimeout(snipeDoorTimer);
      snipeDoorTimer = null;
      let bangB = new Audio("metalbang.mp3");
      bangB.play();
    }
    if (Mouse==="doorB") {
      Mouse="CAM1";
      clearTimeout(mouseDoorTimer);
      mouseDoorTimer = null;
      let bangC = new Audio("scratching.mp3");
      bangC.play();
    }
  }
  updateCameraView();
  updateDoorSprites();
}

    function startParanoiaTimer(which) {
  if (which === "A") {
    clearParanoiaTimer("A");
    doorAParanoiaTimer = setTimeout(() => {
      paranoid = true;
      console.log("Paranoia triggered by Door A");
    }, 7000);
  }
  if (which === "B") {
    clearParanoiaTimer("B");
    doorBParanoiaTimer = setTimeout(() => {
      paranoid = true;
      console.log("Paranoia triggered by Door B");
    }, 7000);
  }
}

function clearParanoiaTimer(which) {
  if (which === "A" && doorAParanoiaTimer) {
    clearTimeout(doorAParanoiaTimer);
    doorAParanoiaTimer = null;
  }
  if (which === "B" && doorBParanoiaTimer) {
    clearTimeout(doorBParanoiaTimer);
    doorBParanoiaTimer = null;
  }
}
    
setInterval(() => {
  if (doorAClosed && doorAClosedAt && !doorADisabled) {
    let elapsed = (Date.now() - doorAClosedAt) / 1000;
    if (doorATotalClosed + elapsed >= 120) {
      disableDoor("A");
    }
  }
  if (doorBClosed && doorBClosedAt && !doorBDisabled) {
    let elapsed = (Date.now() - doorBClosedAt) / 1000;
    if (doorBTotalClosed + elapsed >= 120) {
      disableDoor("B");
    }
  }
}, 1000);

    setInterval(() => {
  let drain = 0;

  if (doorAClosed) drain += 1.0;

  if (doorBClosed) drain += 1.0;

  doorPower = Math.max(0, doorPower - drain);

  updatePowerLabel();

  if (doorPower <= 0) {
    disableDoor("A");
    disableDoor("B");
  }
}, 1000);
    
    function updatePowerLabel() {
  document.getElementById("powerLabel").textContent = Math.floor(doorPower) + "%";
}


    
function disableDoor(which) {
  if (which === "A") {
    doorAClosed = false;
    doorADisabled = true;
    doorAClosedAt = null;
    document.getElementById("doorA").src = "doorAoff.png";
    console.log("Door A permanently disabled");
  }
  if (which === "B") {
    doorBClosed = false;
    doorBDisabled = true;
    doorBClosedAt = null;
    document.getElementById("doorB").src = "doorBoff.png";
    console.log("Door B permanently disabled");
  }
}

function showMenu() {
  document.getElementById("game").style.display = "none";
  document.getElementById("menu").style.display = "block";

  const continueBtn = document.getElementById("continueBtn");
  const customNightBtn = document.getElementById("customNightBtn");

  if (Night1Won || Night2Won || Night3Won || Night4Won || Night5Won) {
    continueBtn.classList.remove("disabled");
    continueBtn.textContent = "Continue (Night " + currentNight + ")";
  } else {
    continueBtn.classList.add("disabled");
    continueBtn.textContent = "Continue";
  }

  if (Night5Won) {
    customNightBtn.style.display = "block"; 
  } else {
    customNightBtn.style.display = "none";
  }
}


document.getElementById("continueBtn").addEventListener("click", () => {
  if (!document.getElementById("continueBtn").classList.contains("disabled")) {
    document.getElementById("menu").style.display = "none";
    document.getElementById("game").style.display = "block";

    Night6 = false;

    const ambience = document.getElementById("ambience");
    ambience.volume = 0.1;
    ambience.play();

    startAI();
    startInfectionMeter();
    startNight();
    bossTimer = setInterval(updateBoss, 5000);
  }
});


function killPlayer(enemy) {
  const camView = document.getElementById("camView");
  camView.style.display = "block";
  camView.src = enemy.toLowerCase() + "jumpscare.png";

  let audio = new Audio("jumpscare.mp3");
  audio.play();

  setTimeout(() => {
    showMenu();
    resetAllGameStates();
  }, 3000);
}

    function resetAllGameStates() {
  
  if (punchDoorTimer) {
    clearTimeout(punchDoorTimer);
    punchDoorTimer = null;
  }
  if (snipeDoorTimer) {
    clearTimeout(snipeDoorTimer);
    snipeDoorTimer = null;
  }
  if (mouseDoorTimer) {
    clearTimeout(mouseDoorTimer);
    mouseDoorTimer = null;
  }

  
  Punch = "CAM1";
  Snipe = "CAM1";
  Mouse = "CAM1";


  if (paranoiaTimer) {
    clearTimeout(paranoiaTimer);
    paranoiaTimer = null;
  }
  paranoid = false;

BossStage = 1;
BossProgress = 0;

if (bossTimer) {
  clearInterval(bossTimer);
  bossTimer = null;
}

rocketActive = false;
rocketCam = null;

if (rocketTimer) {
  clearTimeout(rocketTimer);
  rocketTimer = null;
}

if (infectionInterval) {
  clearInterval(infectionInterval);
  infectionInterval = null;
}



  doorAClosed = false;
  doorBClosed = false;
  doorADisabled = false;
  doorBDisabled = false;
  doorATotalClosed = 0;
  doorBTotalClosed = 0;
  doorAClosedAt = null;
  doorBClosedAt = null;
  document.getElementById("doorA").src = "doorAoff.png";
  document.getElementById("doorB").src = "doorBoff.png";

  
  document.getElementById("staticOverlay").style.display = "none";
  document.getElementById("darkOverlay").style.opacity = 0;

  
  document.getElementById("camLabel").textContent = "CAM1";
  document.getElementById("hourLabel").textContent = "12AM";

  console.log("Game states reset for next night");
}

let keySequence = [];
const resetCombo = ["c", "d", "+"];

document.addEventListener("keydown", e => {
  let keyPressed = e.key.toLowerCase();

  if (e.key === "=" && e.shiftKey) {
    keyPressed = "+";
  }

  keySequence.push(keyPressed);

  if (keySequence.length > 3) {
    keySequence.shift();
  }

  if (keySequence.join("") === resetCombo.join("")) {
 
    localStorage.clear();

    resetAllGameStates();

    showMenu();

    console.log("CD+ combo entered: bozo");
  }
});
  showMenu();

  </script>
</body>
</html>
